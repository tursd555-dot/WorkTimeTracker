"""
–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –¥–ª—è WorkTimeTracker.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- Development: –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ ~/.wtt/config.enc + keyring
- Production: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ AWS Secrets Manager
- CI/CD: GitHub Secrets ‚Üí environment variables
- Testing: –º–æ–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    from config_secure import get_config
    
    config = get_config()
    spreadsheet_id = config.get_spreadsheet_id()
    bot_token = config.get_telegram_token()
    creds_path = config.get_google_credentials_path()

Features:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ credentials
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º keyring (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π (dev/staging/prod)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- Graceful degradation –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ credentials

–ê–≤—Ç–æ—Ä: WorkTimeTracker Security Team
–î–∞—Ç–∞: 2025-11-24
"""

import os
import json
import logging
import tempfile
import atexit
from pathlib import Path
from typing import Optional, Dict, Any
from cryptography.fernet import Fernet
import keyring

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger = logging.getLogger(__name__)


class ConfigurationError(Exception):
    """–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    pass


class SecureConfig:
    """
    –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤.
    
    –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    
    1. Production (APP_ENV=production):
       - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
       - AWS Secrets Manager / HashiCorp Vault
       - Kubernetes Secrets
    
    2. Development (APP_ENV=development):
       - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª ~/.wtt/config.enc
       - –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º keyring
    
    3. Testing (APP_ENV=testing):
       - –ú–æ–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    
    Attributes:
        env: –¢–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (development/staging/production/testing)
        config_dir: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (~/.wtt)
        _config: –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (dict)
    """
    
    # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    KEYRING_SERVICE = "WorkTimeTracker"
    KEYRING_KEY_NAME = "config_encryption_key"
    CONFIG_DIR_NAME = ".wtt"
    CONFIG_FILE_NAME = "config.enc"
    
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    REQUIRED_PARAMS = {
        'production': [
            'SPREADSHEET_ID',
            'GOOGLE_CREDENTIALS_JSON',
            'TELEGRAM_BOT_TOKEN'
        ],
        'development': [
            'SPREADSHEET_ID'
        ],
        'testing': []
    }
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        self.env = os.getenv("APP_ENV", "development").lower()
        self.config_dir = Path.home() / self.CONFIG_DIR_NAME
        self.config_dir.mkdir(exist_ok=True)
        
        self._config: Optional[Dict[str, Any]] = None
        self._temp_credentials_path: Optional[str] = None
        
        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        self._load_config()
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        self._validate_config()
        
        logger.info(f"Configuration loaded for environment: {self.env}")
    
    def _load_config(self):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        try:
            if self.env == "production":
                self._load_from_environment()
            elif self.env == "development":
                self._load_from_encrypted_file()
            elif self.env == "testing":
                self._load_test_config()
            else:
                raise ConfigurationError(
                    f"Unknown environment: {self.env}. "
                    f"Expected: development, staging, production, testing"
                )
        except Exception as e:
            logger.error(f"Failed to load configuration: {e}")
            raise ConfigurationError(f"Configuration loading failed: {e}")
    
    def _load_from_environment(self):
        """
        Production: –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
        
        –û–∂–∏–¥–∞–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
        - SPREADSHEET_ID
        - GOOGLE_CREDENTIALS_JSON (JSON string)
        - TELEGRAM_BOT_TOKEN
        - TELEGRAM_ADMIN_CHAT_ID (optional)
        """
        logger.info("Loading configuration from environment variables")
        
        self._config = {
            'google': {
                'spreadsheet_id': os.getenv('SPREADSHEET_ID'),
                'worksheet_name': os.getenv('WORKSHEET_NAME', 'WorkTime'),
                'credentials_json': os.getenv('GOOGLE_CREDENTIALS_JSON')
            },
            'telegram': {
                'bot_token': os.getenv('TELEGRAM_BOT_TOKEN'),
                'admin_chat_id': os.getenv('TELEGRAM_ADMIN_CHAT_ID')
            },
            'app': {
                'version': os.getenv('APP_VERSION', '1.0.0'),
                'log_level': os.getenv('LOG_LEVEL', 'INFO')
            },
            'sync': {
                'interval': int(os.getenv('SYNC_INTERVAL', '30')),
                'batch_size': int(os.getenv('SYNC_BATCH_SIZE', '20')),
                'max_attempts': int(os.getenv('SYNC_MAX_ATTEMPTS', '5')),
                'conflict_strategy': os.getenv('SYNC_CONFLICT_STRATEGY', 'last_write_wins')
            },
            'security': {
                'db_encryption_enabled': os.getenv('DB_ENCRYPTION_ENABLED', 'true').lower() == 'true'
            }
        }
    
    def _load_from_encrypted_file(self):
        """
        Development: –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
        
        –§–∞–π–ª: ~/.wtt/config.enc
        –ö–ª—é—á: –°–∏—Å—Ç–µ–º–Ω—ã–π keyring
        
        Raises:
            FileNotFoundError: –ï—Å–ª–∏ config.enc –Ω–µ –Ω–∞–π–¥–µ–Ω
            ValueError: –ï—Å–ª–∏ –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω
        """
        logger.info("Loading configuration from encrypted file")
        
        encrypted_file = self.config_dir / self.CONFIG_FILE_NAME
        
        if not encrypted_file.exists():
            raise FileNotFoundError(
                f"Encrypted config not found at {encrypted_file}\n\n"
                f"To create it, run:\n"
                f"  python -m tools.wtt_setup init\n"
                f"  python -m tools.wtt_setup add-google /path/to/service_account.json\n"
                f"  python -m tools.wtt_setup add-telegram"
            )
        
        # –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏–∑ keyring
        encryption_key = keyring.get_password(
            self.KEYRING_SERVICE,
            self.KEYRING_KEY_NAME
        )
        
        if not encryption_key:
            raise ValueError(
                f"Encryption key not found in system keyring.\n\n"
                f"Service: {self.KEYRING_SERVICE}\n"
                f"Key: {self.KEYRING_KEY_NAME}\n\n"
                f"To fix, run: python -m tools.wtt_setup init"
            )
        
        # –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥
        try:
            cipher = Fernet(encryption_key.encode())
            
            with open(encrypted_file, "rb") as f:
                encrypted_data = f.read()
            
            decrypted = cipher.decrypt(encrypted_data)
            self._config = json.loads(decrypted)
            
            logger.debug("Configuration decrypted successfully")
            
        except Exception as e:
            raise ConfigurationError(
                f"Failed to decrypt configuration: {e}\n"
                f"The encryption key might be incorrect or the file corrupted."
            )
    
    def _load_test_config(self):
        """Testing: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è"""
        logger.info("Loading test configuration")
        
        self._config = {
            'google': {
                'spreadsheet_id': 'test_spreadsheet_id_123',
                'worksheet_name': 'TestSheet',
                'credentials_json': json.dumps({
                    'type': 'service_account',
                    'project_id': 'test-project',
                    'private_key_id': 'test-key-id',
                    'private_key': '-----BEGIN PRIVATE KEY-----\nTEST\n-----END PRIVATE KEY-----',
                    'client_email': 'test@test-project.iam.gserviceaccount.com',
                    'client_id': '123456789',
                    'auth_uri': 'https://accounts.google.com/o/oauth2/auth',
                    'token_uri': 'https://oauth2.googleapis.com/token'
                })
            },
            'telegram': {
                'bot_token': 'test_bot_token_123',
                'admin_chat_id': 'test_chat_id_123'
            },
            'app': {
                'version': '1.0.0-test',
                'log_level': 'DEBUG'
            },
            'sync': {
                'interval': 5,
                'batch_size': 10,
                'max_attempts': 3,
                'conflict_strategy': 'last_write_wins'
            },
            'security': {
                'db_encryption_enabled': False  # –î–ª—è —Ç–µ—Å—Ç–æ–≤ –æ—Ç–∫–ª—é—á–∞–µ–º
            }
        }
    
    def _validate_config(self):
        """
        –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
        
        Raises:
            ConfigurationError: –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        """
        if not self._config:
            raise ConfigurationError("Configuration is empty")
        
        required_params = self.REQUIRED_PARAMS.get(self.env, [])
        
        for param in required_params:
            value = None
            
            if param == 'SPREADSHEET_ID':
                value = self._config.get('google', {}).get('spreadsheet_id')
            elif param == 'GOOGLE_CREDENTIALS_JSON':
                value = self._config.get('google', {}).get('credentials_json')
            elif param == 'TELEGRAM_BOT_TOKEN':
                value = self._config.get('telegram', {}).get('bot_token')
            
            if not value:
                raise ConfigurationError(
                    f"Missing required parameter: {param}\n"
                    f"Environment: {self.env}"
                )
        
        logger.debug("Configuration validation passed")
    
    # ========================================================================
    # PUBLIC API
    # ========================================================================
    
    def get_spreadsheet_id(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å ID Google Spreadsheet"""
        return self._config['google']['spreadsheet_id']
    
    def get_worksheet_name(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ worksheet (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: WorkTime)"""
        return self._config['google'].get('worksheet_name', 'WorkTime')
    
    def get_google_credentials_path(self) -> str:
        """
        –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ Google credentials.
        
        –°–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å credentials –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å gspread.
        –§–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
        
        Returns:
            –ü—É—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É —Å credentials
        """
        if self._temp_credentials_path:
            return self._temp_credentials_path
        
        credentials_json = self._config['google'].get('credentials_json')
        
        if not credentials_json:
            raise ConfigurationError(
                "Google credentials not found in configuration"
            )
        
        # –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        fd, temp_path = tempfile.mkstemp(suffix='.json', prefix='gcp_creds_')
        
        # –ó–∞–ø–∏—Å–∞—Ç—å credentials
        with os.fdopen(fd, 'w') as f:
            f.write(credentials_json)
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç—å
        self._temp_credentials_path = temp_path
        
        # –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
        atexit.register(self._cleanup_temp_credentials)
        
        logger.debug(f"Created temporary credentials file: {temp_path}")
        
        return temp_path
    
    def get_telegram_token(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å Telegram Bot Token"""
        return self._config['telegram']['bot_token']
    
    def get_telegram_admin_chat_id(self) -> Optional[str]:
        """–ü–æ–ª—É—á–∏—Ç—å Telegram Admin Chat ID (–º–æ–∂–µ—Ç –±—ã—Ç—å None)"""
        return self._config['telegram'].get('admin_chat_id')
    
    def get_sync_interval(self) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)"""
        return self._config.get('sync', {}).get('interval', 30)
    
    def get_sync_batch_size(self) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä batch –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏"""
        return self._config.get('sync', {}).get('batch_size', 20)
    
    def get_sync_max_attempts(self) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏"""
        return self._config.get('sync', {}).get('max_attempts', 5)
    
    def get_sync_conflict_strategy(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤"""
        return self._config.get('sync', {}).get('conflict_strategy', 'last_write_wins')
    
    def is_db_encryption_enabled(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–∫–ª—é—á–µ–Ω–æ –ª–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ë–î"""
        return self._config.get('security', {}).get('db_encryption_enabled', True)
    
    def get_log_level(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
        return self._config.get('app', {}).get('log_level', 'INFO')
    
    def get_app_version(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        return self._config.get('app', {}).get('version', '1.0.0')
    
    def get_all_config(self) -> Dict[str, Any]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).
        
        WARNING: –°–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ! –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å!
        """
        return self._config.copy()
    
    def _cleanup_temp_credentials(self):
        """–£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å credentials"""
        if self._temp_credentials_path and os.path.exists(self._temp_credentials_path):
            try:
                os.unlink(self._temp_credentials_path)
                logger.debug(f"Cleaned up temporary credentials file: {self._temp_credentials_path}")
            except Exception as e:
                logger.warning(f"Failed to cleanup temp credentials: {e}")


# ============================================================================
# SINGLETON INSTANCE
# ============================================================================

_config_instance: Optional[SecureConfig] = None


def get_config() -> SecureConfig:
    """
    –ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (singleton).
    
    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        from config_secure import get_config
        
        config = get_config()
        spreadsheet_id = config.get_spreadsheet_id()
    
    Returns:
        –≠–∫–∑–µ–º–ø–ª—è—Ä SecureConfig
    """
    global _config_instance
    
    if _config_instance is None:
        _config_instance = SecureConfig()
    
    return _config_instance


def reload_config():
    """
    –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
    
    –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥–∞.
    """
    global _config_instance
    _config_instance = None
    return get_config()


# ============================================================================
# CONVENIENCE FUNCTIONS
# ============================================================================

def get_spreadsheet_id() -> str:
    """Shortcut –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Spreadsheet ID"""
    return get_config().get_spreadsheet_id()


def get_telegram_token() -> str:
    """Shortcut –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Telegram token"""
    return get_config().get_telegram_token()


def get_google_credentials_path() -> str:
    """Shortcut –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É—Ç–∏ –∫ Google credentials"""
    return get_config().get_google_credentials_path()


# ============================================================================
# USAGE EXAMPLES
# ============================================================================

if __name__ == "__main__":
    """
    –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SecureConfig.
    
    –ó–∞–ø—É—Å–∫:
        python config_secure.py
    """
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
    logging.basicConfig(
        level=logging.DEBUG,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    print("=" * 80)
    print("SecureConfig - Usage Examples")
    print("=" * 80)
    
    try:
        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config = get_config()
        
        print(f"\n‚úÖ Configuration loaded successfully")
        print(f"Environment: {config.env}")
        print(f"Config directory: {config.config_dir}")
        
        # –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        print(f"\nüìã Configuration parameters:")
        print(f"  Spreadsheet ID: {config.get_spreadsheet_id()}")
        print(f"  Worksheet: {config.get_worksheet_name()}")
        print(f"  Telegram token: {config.get_telegram_token()[:20]}...")
        print(f"  Sync interval: {config.get_sync_interval()}s")
        print(f"  Sync batch size: {config.get_sync_batch_size()}")
        print(f"  DB encryption: {config.is_db_encryption_enabled()}")
        
        # –ü–æ–ª—É—á–∏—Ç—å credentials path
        creds_path = config.get_google_credentials_path()
        print(f"\nüìÅ Temporary credentials file: {creds_path}")
        print(f"  Exists: {os.path.exists(creds_path)}")
        
        print(f"\n‚úÖ All checks passed!")
        
    except ConfigurationError as e:
        print(f"\n‚ùå Configuration Error: {e}")
        print(f"\nTo fix:")
        print(f"  1. Run: python -m tools.wtt_setup init")
        print(f"  2. Run: python -m tools.wtt_setup add-google <path_to_json>")
        print(f"  3. Run: python -m tools.wtt_setup add-telegram")
    
    except Exception as e:
        print(f"\n‚ùå Unexpected error: {e}")
        import traceback
        traceback.print_exc()
    
    print("\n" + "=" * 80)
