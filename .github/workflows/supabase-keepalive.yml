name: Supabase Keep-Alive

# –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –≤ 00:00 UTC
# Supabase –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç—ã —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏,
# –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∑–∞–ø–∞—Å (5 –∑–∞–ø—É—Å–∫–æ–≤ –∑–∞ 7 –¥–Ω–µ–π)
on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –≤ 00:00 UTC –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è (–≤ –ø–æ–ª–Ω–æ—á—å 1-–≥–æ, 3-–≥–æ, 5-–≥–æ, 7-–≥–æ –∏ —Ç.–¥.)
    - cron: '0 0 */2 * *'

  # –¢–∞–∫–∂–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ GitHub UI
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install supabase python-dotenv

      - name: Verify secrets are set
        run: |
          if [ -z "${{ secrets.SUPABASE_URL }}" ] || [ -z "${{ secrets.SUPABASE_KEY }}" ]; then
            echo "‚ùå –û—à–∏–±–∫–∞: SUPABASE_URL –∏–ª–∏ SUPABASE_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ Secrets!"
            echo "–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Secrets and variables ‚Üí Actions –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö"
            exit 1
          else
            echo "‚úÖ Secrets –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã"
          fi

      - name: Run keep-alive script
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ keep-alive —Å–∫—Ä–∏–ø—Ç–∞..."
          python supabase_keepalive.py
          if [ $? -eq 0 ]; then
            echo "‚úÖ Keep-alive –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
          else
            echo "‚ùå Keep-alive –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π"
            exit 1
          fi

      - name: Success notification
        if: success()
        run: |
          echo "‚úÖ ========================================"
          echo "‚úÖ Supabase Keep-Alive –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
          echo "‚úÖ –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫: —á–µ—Ä–µ–∑ 2 –¥–Ω—è"
          echo "‚úÖ ========================================"

      - name: Failure notification
        if: failure()
        run: |
          echo "‚ùå ========================================"
          echo "‚ùå Keep-alive script failed!"
          echo "‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π"
          echo "‚ùå –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ SUPABASE_URL –∏ SUPABASE_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ Secrets"
          echo "‚ùå ========================================"
