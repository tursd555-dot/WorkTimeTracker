# üîç WorkTimeTracker - –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ (Break System)

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞:** 09.12.2025
**–°—Ç–∞—Ç—É—Å:** Complete Analysis & Setup Guide

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–û–±—â–∏–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±—â–∏–π-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
3. [–ú–µ—Ö–∞–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç—ã](#–º–µ—Ö–∞–Ω–∏–∫–∞-—Ä–∞–±–æ—Ç—ã)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
6. [–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#–ø–æ—à–∞–≥–æ–≤–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
7. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
8. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–∏-–æ—Ç–ª–∞–¥–∫–∞)

---

## üéØ –û–±—â–∏–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ß—Ç–æ —ç—Ç–æ?
**–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤** - —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç WorkTimeTracker, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –°–∏—Å—Ç–µ–º–∞:

- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç **3 —Ç–∏–ø–∞ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –≤ –¥–µ–Ω—å** (–ø–æ 15 –º–∏–Ω—É—Ç) –∏ **1 –æ–±–µ–¥** (60 –º–∏–Ω—É—Ç)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ **–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10:00-12:00)
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ **Telegram**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ **Supabase PostgreSQL**
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ **–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏**
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–µ—Ä–µ—Ä—ã–≤—ã –≤ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ** | –®–∞–±–ª–æ–Ω—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥—Ä—É–ø–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ü—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –≥—Ä–∞—Ñ–∏–∫—É |
| **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞** | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏ |
| **–õ–∏–º–∏—Ç—ã** | –ú–∞–∫—Å–∏–º—É–º –º–∏–Ω—É—Ç –Ω–∞ 1 –ø–µ—Ä–µ—Ä—ã–≤, –º–∞–∫—Å–∏–º—É–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –¥–µ–Ω—å |
| **–ù–∞—Ä—É—à–µ–Ω–∏—è** | 3 —Ç–∏–ø–∞ —Å —Ä–∞–∑–Ω–æ–π —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å—é |
| **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** | Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** | Dashboard —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ Excel-—ç–∫—Å–ø–æ—Ä—Ç–æ–º |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. **BreakManager** (`admin_app/break_manager.py`)
**–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤** (1127 —Å—Ç—Ä–æ–∫)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:
```python
@dataclass
class BreakLimit:
    break_type: str      # "–ü–µ—Ä–µ—Ä—ã–≤" –∏–ª–∏ "–û–±–µ–¥"
    daily_count: int     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –¥–µ–Ω—å (3 –∏–ª–∏ 1)
    time_minutes: int    # –õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (15 –∏–ª–∏ 60)

@dataclass
class BreakWindow:
    break_type: str      # "–ü–µ—Ä–µ—Ä—ã–≤" –∏–ª–∏ "–û–±–µ–¥"
    start_time: time     # –ù–∞—á–∞–ª–æ –æ–∫–Ω–∞ (10:00)
    end_time: time       # –ö–æ–Ω–µ—Ü –æ–∫–Ω–∞ (12:00)
    priority: int        # 1 = –æ—Å–Ω–æ–≤–Ω–æ–µ, 2 = –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ

@dataclass
class BreakSchedule:
    schedule_id: str     # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    name: str            # –ù–∞–∑–≤–∞–Ω–∏–µ ("–ì—Ä–∞—Ñ–∏–∫ 5/2")
    shift_start: time    # –ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã (09:00)
    shift_end: time      # –ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã (17:00)
    limits: List[BreakLimit]
    windows: List[BreakWindow]
```

#### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏:**
- `create_schedule()` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
- `get_schedule(schedule_id)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
- `list_schedules()` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
- `delete_schedule(schedule_id)` - –£–¥–∞–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤:**
- `assign_schedule(email, schedule_id, admin_email)` - –ü—Ä–∏–≤—è–∑–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `get_user_schedule(email)` - –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
- `unassign_schedule(email)` - –°–Ω—è—Ç—å –≥—Ä–∞—Ñ–∏–∫

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤:**
- `start_break(email, break_type, session_id)` - –ù–∞—á–∞—Ç—å –ø–µ—Ä–µ—Ä—ã–≤
- `end_break(email, break_type)` - –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ—Ä—ã–≤
- `get_break_status(email)` - –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ—Ä—ã–≤–æ–≤

**–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
- `get_violations_report()` - –û—Ç—á–µ—Ç –ø–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º
- `get_usage_stats()` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `get_all_active_breaks()` - –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤

---

### 2. **BreakStatusIntegration** (`shared/break_status_integration.py`)
**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (200 —Å—Ç—Ä–æ–∫)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç BreakManager –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å
           ‚Üì
on_status_change() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
           ‚Üì
–ï—Å–ª–∏ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å = "–ü–µ—Ä–µ—Ä—ã–≤"/"–û–±–µ–¥"
           ‚Üì
start_break() –≤ BreakManager
           ‚Üì
–ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å = "–ü–µ—Ä–µ—Ä—ã–≤"/"–û–±–µ–¥"
           ‚Üì
end_break() –≤ BreakManager
```

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `on_status_change(email, old_status, new_status)` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
- `on_logout(email)` - –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ—Ä—ã–≤ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ

---

### 3. **BreakNotifications** (`shared/break_notifications.py`)
**–°–∏—Å—Ç–µ–º–∞ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (500 —Å—Ç—Ä–æ–∫)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç UI)
- üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä—ã
- ‚è±Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å 2-—Å–µ–∫—É–Ω–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

**–§—É–Ω–∫—Ü–∏–∏:**
- `send_overtime_notification()` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
- `send_quota_exceeded_notification()` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- `send_break_reminder()` - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä–µ—Ä—ã–≤–∞—Ö

---

### 4. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI**

#### BreakInfoWidget (`user_app/break_info_widget.py`)
–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
üìä –ü–ï–†–ï–†–´–í–´
‚îú‚îÄ –û—Å—Ç–∞–ª–æ—Å—å: 2/3
‚îú‚îÄ üü¢ –ê–∫—Ç–∏–≤–µ–Ω: –ü–µ—Ä–µ—Ä—ã–≤ (5 –º–∏–Ω –∏–∑ 15)
‚îî‚îÄ üçΩÔ∏è  –û–±–µ–¥: 1/1

‚è∞ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
```

#### BreakAnalyticsTab (`admin_app/break_analytics_tab.py`)
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π (900 —Å—Ç—Ä–æ–∫):
- üìä Real-time Dashboard
- üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π
- üìà –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã
- üì• Excel-—ç–∫—Å–ø–æ—Ä—Ç
- üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

## üîÑ –ú–µ—Ö–∞–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ä—ã–≤–∞

```
1Ô∏è‚É£  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å ‚Üí "–ü–µ—Ä–µ—Ä—ã–≤"
2Ô∏è‚É£  –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç on_status_change()
3Ô∏è‚É£  start_break() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
    ‚úì –ï—Å—Ç—å –ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫?
    ‚úì –ù–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∞ –ª–∏ –¥–Ω–µ–≤–Ω–∞—è –∫–≤–æ—Ç–∞? (3/3)
    ‚úì –í –ª–∏ —Ä–∞–º–∫–∞—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞? (10:00-12:00)
4Ô∏è‚É£  –ï—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–≤–æ—Ç—ã:
    ‚Üí QUOTA_EXCEEDED (CRITICAL)
    ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
    ‚Üí –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ—Ä—ã–≤ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º)
5Ô∏è‚É£  –ï—Å–ª–∏ –≤–Ω–µ –æ–∫–Ω–∞:
    ‚Üí OUT_OF_WINDOW (INFO)
    ‚Üí –¢–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ—Ç
6Ô∏è‚É£  –ó–∞–ø–∏—Å–∞—Ç—å –≤ BreakLog: Email, StartTime, Status=Active
7Ô∏è‚É£  ‚úÖ –ü–µ—Ä–µ—Ä—ã–≤ –Ω–∞—á–∞—Ç
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—Ä–µ—Ä—ã–≤–∞

```
1Ô∏è‚É£  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å ‚Üí "–†–∞–±–æ—Ç–∞—é" (–∏–ª–∏ –¥—Ä—É–≥–æ–π)
2Ô∏è‚É£  –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç on_status_change()
3Ô∏è‚É£  end_break() –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
    ‚úì –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤ (–±–µ–∑ EndTime)
    ‚úì –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    ‚úì –û–±–Ω–æ–≤–∏—Ç—å BreakLog: EndTime, Duration, Status=Completed
4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏:
    –ï—Å–ª–∏ duration > limit + 2 –º–∏–Ω—É—Ç—ã:
    ‚Üí OVER_LIMIT (CRITICAL)
    ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
5Ô∏è‚É£  ‚úÖ –ü–µ—Ä–µ—Ä—ã–≤ –∑–∞–≤–µ—Ä—à–µ–Ω
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Logout –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
1Ô∏è‚É£  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2Ô∏è‚É£  –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç on_logout()
3Ô∏è‚É£  –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤:
    ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–≤–∞—Ç—å end_break()
    ‚Üí –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ—Ä—ã–≤ —Å —Ç–µ–∫—É—â–µ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
4Ô∏è‚É£  ‚úÖ –ü–µ—Ä–µ—Ä—ã–≤ –∑–∞–≤–µ—Ä—à–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
```

---

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã Supabase

#### 1. **break_schedules** - –®–∞–±–ª–æ–Ω—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤
```sql
id (UUID)              -- –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
name (VARCHAR)         -- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ì—Ä–∞—Ñ–∏–∫ 5/2"
description (TEXT)     -- –û–ø–∏—Å–∞–Ω–∏–µ
shift_start (TIME)     -- –ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã: 09:00
shift_end (TIME)       -- –ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã: 17:00
is_active (BOOLEAN)    -- –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –≥—Ä–∞—Ñ–∏–∫
created_by (VARCHAR)   -- –ö—Ç–æ —Å–æ–∑–¥–∞–ª
created_at / updated_at
```

#### 2. **break_limits** - –õ–∏–º–∏—Ç—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
```sql
id (UUID)
schedule_id (UUID)     -- –°—Å—ã–ª–∫–∞ –Ω–∞ break_schedules
break_type (VARCHAR)   -- "–ü–µ—Ä–µ—Ä—ã–≤" –∏–ª–∏ "–û–±–µ–¥"
duration_minutes (INT) -- 15 –∏–ª–∏ 60 –º–∏–Ω—É—Ç
daily_count (INT)      -- 3 –∏–ª–∏ 1 –≤ –¥–µ–Ω—å
```

#### 3. **user_break_assignments** - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
```sql
id (UUID)
user_id (UUID)         -- –°—Å—ã–ª–∫–∞ –Ω–∞ users
email (VARCHAR)        -- Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
schedule_id (UUID)     -- –°—Å—ã–ª–∫–∞ –Ω–∞ break_schedules
assigned_date (TIMESTAMPTZ)
assigned_by (VARCHAR)  -- –ö—Ç–æ –Ω–∞–∑–Ω–∞—á–∏–ª
is_active (BOOLEAN)
```

#### 4. **break_log** - –õ–æ–≥ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
```sql
id (UUID)
user_id (UUID)
email (VARCHAR)
name (VARCHAR)         -- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
break_type (VARCHAR)   -- "–ü–µ—Ä–µ—Ä—ã–≤" –∏–ª–∏ "–û–±–µ–¥"
start_time (TIMESTAMPTZ)
end_time (TIMESTAMPTZ) -- NULL –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω
duration_minutes (INT) -- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
date (DATE)            -- –î–∞—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
status (VARCHAR)       -- Active –∏–ª–∏ Completed
is_over_limit (BOOLEAN)
session_id (VARCHAR)
```

#### 5. **violations** - –ù–∞—Ä—É—à–µ–Ω–∏—è
```sql
id (UUID)
user_id (UUID)
email (VARCHAR)
name (VARCHAR)
violation_type (VARCHAR)  -- OUT_OF_WINDOW, OVER_LIMIT, QUOTA_EXCEEDED
break_type (VARCHAR)
timestamp (TIMESTAMPTZ)
expected_duration (INT)
actual_duration (INT)
excess_minutes (INT)
date (DATE)
details (TEXT)
```

### PostgreSQL –§—É–Ω–∫—Ü–∏–∏ (–¢—Ä–∏–≥–≥–µ—Ä—ã)

```sql
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞
calculate_break_duration()
‚îó‚îÄ –ö–æ–≥–¥–∞ end_time –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è
‚îó‚îÄ –í—ã—á–∏—Å–ª—è–µ—Ç: duration_minutes = end_time - start_time
‚îó‚îÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: status = 'Completed'
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `config.py`

#### Break System Constants
```python
# –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–æ–≤ (Google Sheets –∏–ª–∏ Supabase)
BREAK_SCHEDULES_SHEET = "BreakSchedules"
USER_BREAK_ASSIGNMENTS_SHEET = "UserBreakAssignments"
BREAK_USAGE_LOG_SHEET = "BreakLog"
BREAK_VIOLATIONS_SHEET = "Violations"

# –¢–∏–ø—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
BREAK_TYPE_SHORT = "–ü–µ—Ä–µ—Ä—ã–≤"     # –ö–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–µ—Ä—ã–≤ (15 –º–∏–Ω)
BREAK_TYPE_LUNCH = "–û–±–µ–¥"        # –û–±–µ–¥–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤ (60 –º–∏–Ω)

# –õ–∏–º–∏—Ç—ã (–¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ)
BREAK_LIMIT_MINUTES = 15         # –ú–∞–∫—Å–∏–º—É–º –Ω–∞ 1 –ø–µ—Ä–µ—Ä—ã–≤
LUNCH_LIMIT_MINUTES = 60         # –ú–∞–∫—Å–∏–º—É–º –Ω–∞ –æ–±–µ–¥

# –ü–æ—Ä–æ–≥ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è (–º–∏–Ω—É—Ç—ã)
BREAK_OVERTIME_THRESHOLD = 2      # –°—á–∏—Ç–∞–µ–º –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ –Ω–∞ 2+ –º–∏–Ω

# –¢–∏–ø—ã –Ω–∞—Ä—É—à–µ–Ω–∏–π
VIOLATION_TYPE_OUT_OF_WINDOW = "OUT_OF_WINDOW"      # –í–Ω–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞
VIOLATION_TYPE_OVER_LIMIT = "OVER_LIMIT"            # –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏
VIOLATION_TYPE_QUOTA_EXCEEDED = "QUOTA_EXCEEDED"    # –ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

# –£—Ä–æ–≤–Ω–∏ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
SEVERITY_INFO = "INFO"           # –¢–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
SEVERITY_WARNING = "WARNING"     # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
SEVERITY_CRITICAL = "CRITICAL"  # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é + –∞–¥–º–∏–Ω—É

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
BREAK_NOTIFY_USER_ON_VIOLATION = True      # –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
BREAK_NOTIFY_ADMIN_ON_VIOLATION = True     # –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```bash
# Supabase
SUPABASE_URL=https://jtgaobxbwibjcvasefzi.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
TELEGRAM_ADMIN_GROUP_ID=-987654321
TELEGRAM_USER_BOT_ID=987654321

# –õ–∏–º–∏—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è)
BREAK_LIMIT_MINUTES=15
LUNCH_LIMIT_MINUTES=60
```

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤

#### 1.1 –í –∞–¥–º–∏–Ω-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Admin App ‚Üí Break Manager**
2. –ù–∞–∂–∞—Ç—å **"Create Schedule Template"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
   - **Schedule ID**: `SHIFT_8H` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
   - **Name**: `–ì—Ä–∞—Ñ–∏–∫ 5/2 (9-18)` (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
   - **Shift Start**: `09:00`
   - **Shift End**: `17:00`

4. –î–æ–±–∞–≤–∏—Ç—å **Break Slot #1 (–ü–µ—Ä–µ—Ä—ã–≤)**:
   - Break Type: `–ü–µ—Ä–µ—Ä—ã–≤`
   - Duration: `15` –º–∏–Ω—É—Ç
   - Window Start: `10:00`
   - Window End: `12:00`
   - Priority: `1`
   - Repeat this 3 times for 3 slots

5. –î–æ–±–∞–≤–∏—Ç—å **Break Slot #2 (–û–±–µ–¥)**:
   - Break Type: `–û–±–µ–¥`
   - Duration: `60` –º–∏–Ω—É—Ç
   - Window Start: `12:00`
   - Window End: `14:00`
   - Priority: `1`

6. –ù–∞–∂–∞—Ç—å **"Create"** ‚úÖ

#### 1.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ BreakSchedules

–í Supabase –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∑–∞–ø–∏—Å–∏:

| schedule_id | name | break_type | duration_minutes | window_start | window_end | priority |
|---|---|---|---|---|---|---|
| SHIFT_8H | –ì—Ä–∞—Ñ–∏–∫ 5/2 | –ü–µ—Ä–µ—Ä—ã–≤ | 15 | 10:00 | 12:00 | 1 |
| SHIFT_8H | –ì—Ä–∞—Ñ–∏–∫ 5/2 | –ü–µ—Ä–µ—Ä—ã–≤ | 15 | 10:00 | 12:00 | 1 |
| SHIFT_8H | –ì—Ä–∞—Ñ–∏–∫ 5/2 | –ü–µ—Ä–µ—Ä—ã–≤ | 15 | 10:00 | 12:00 | 1 |
| SHIFT_8H | –ì—Ä–∞—Ñ–∏–∫ 5/2 | –û–±–µ–¥ | 60 | 12:00 | 14:00 | 1 |

---

### –≠—Ç–∞–ø 2: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

#### 2.1 –í –∞–¥–º–∏–Ω-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Admin App ‚Üí Users Management**
2. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ivan@company.com)
3. –ù–∞–∂–∞—Ç—å **"Assign Break Schedule"**
4. –í—ã–±—Ä–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫: `SHIFT_8H`
5. –ù–∞–∂–∞—Ç—å **"Assign"** ‚úÖ

#### 2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Supabase

–í —Ç–∞–±–ª–∏—Ü–µ `user_break_assignments`:

| user_id | email | schedule_id | assigned_date | is_active |
|---|---|---|---|---|
| uuid-123 | ivan@company.com | SHIFT_8H | 2025-12-09 | true |

---

### –≠—Ç–∞–ø 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 3.1 –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

1. –û—Ç–∫—Ä—ã—Ç—å **@BotFather** –≤ Telegram
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `/newbot`
3. –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω: `123456:ABC-DEF1234ghIkl...`

#### 3.2 –ü–æ–ª—É—á–∏—Ç—å ID –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø—ã

1. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `@username`
3. –ü–µ—Ä–µ–π—Ç–∏: `https://api.telegram.org/bot<TOKEN>/getUpdates`
4. –ù–∞–π—Ç–∏ `chat.id` (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)

#### 3.3 –ü–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –±–æ—Ç—É –≤ –ª–∏—á–∫—É
2. –ü–æ–ª—É—á–∏—Ç—å `message.from.id`

#### 3.4 –ó–∞–ø–∏—Å–∞—Ç—å –≤ .env

```bash
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
TELEGRAM_ADMIN_GROUP_ID=-987654321
TELEGRAM_USER_BOT_ID=987654321
```

#### 3.5 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ config.py

```python
BREAK_NOTIFY_USER_ON_VIOLATION = True
BREAK_NOTIFY_ADMIN_ON_VIOLATION = True
```

---

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

#### 4.1 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã
python /home/user/WorkTimeTracker/dev-tools/diagnostic/check_active_breaks.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
python /home/user/WorkTimeTracker/dev-tools/diagnostic/check_break_init.py

# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
python /home/user/WorkTimeTracker/dev-tools/diagnostic/diagnose_breaks.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è
python /home/user/WorkTimeTracker/dev-tools/diagnostic/diagnose_violations.py
```

#### 4.2 –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –≥—Ä–∞—Ñ–∏–∫–æ–º
2. **–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å** ‚Üí "–ü–µ—Ä–µ—Ä—ã–≤"
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
   - ‚úÖ –í BreakLog –ø–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å —Å StartTime
   - ‚úÖ –í BreakInfoWidget –ø–æ–∫–∞–∑–∞–ª–æ—Å—å "–ê–∫—Ç–∏–≤–µ–Ω: –ü–µ—Ä–µ—Ä—ã–≤"
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram (–µ—Å–ª–∏ –≤–Ω–µ –æ–∫–Ω–∞)
4. **–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å** ‚Üí "–†–∞–±–æ—Ç–∞—é"
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
   - ‚úÖ –í BreakLog –∑–∞–ø–æ–ª–Ω–∏–ª–∞—Å—å EndTime –∏ Duration
   - ‚úÖ Status = "Completed"
   - ‚úÖ BreakInfoWidget –æ–±–Ω–æ–≤–∏–ª—Å—è

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –∫–æ–¥–µ

```python
from admin_app.break_manager import BreakManager
from sheets_api import SheetsAPI

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
sheets = SheetsAPI()
break_mgr = BreakManager(sheets)

# –°–æ–∑–¥–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫
success = break_mgr.create_schedule(
    schedule_id="SHIFT_8H",
    name="–ì—Ä–∞—Ñ–∏–∫ 5/2 (9-18)",
    shift_start="09:00",
    shift_end="17:00",
    limits=[
        {"break_type": "–ü–µ—Ä–µ—Ä—ã–≤", "daily_count": 3, "time_minutes": 15},
        {"break_type": "–û–±–µ–¥", "daily_count": 1, "time_minutes": 60}
    ],
    windows=[
        {"break_type": "–ü–µ—Ä–µ—Ä—ã–≤", "start": "10:00", "end": "12:00", "priority": 1},
        {"break_type": "–ü–µ—Ä–µ—Ä—ã–≤", "start": "14:00", "end": "16:00", "priority": 2},
        {"break_type": "–û–±–µ–¥", "start": "12:00", "end": "14:00", "priority": 1}
    ]
)

if success:
    print("‚úÖ –ì—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω")
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–∞–∑–Ω–∞—á–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```python
# –ù–∞–∑–Ω–∞—á–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫
success = break_mgr.assign_schedule(
    email="ivan@company.com",
    schedule_id="SHIFT_8H",
    admin_email="admin@company.com"
)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
schedule = break_mgr.get_user_schedule("ivan@company.com")
if schedule:
    print(f"üìä –ì—Ä–∞—Ñ–∏–∫: {schedule.name}")
    print(f"–õ–∏–º–∏—Ç—ã:")
    for limit in schedule.limits:
        print(f"  - {limit.break_type}: {limit.daily_count}x{limit.time_minutes} –º–∏–Ω")
```

### –ü—Ä–∏–º–µ—Ä 3: –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–º–µ–Ω—É —Å—Ç–∞—Ç—É—Å–∞

```python
from shared.break_status_integration import on_status_change, on_logout

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "–ü–µ—Ä–µ—Ä—ã–≤"
on_status_change(
    email="ivan@company.com",
    old_status="–†–∞–±–æ—Ç–∞—é",
    new_status="–ü–µ—Ä–µ—Ä—ã–≤",
    session_id="sess-123"
)

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å –ø–µ—Ä–µ—Ä—ã–≤–∞
on_status_change(
    email="ivan@company.com",
    old_status="–ü–µ—Ä–µ—Ä—ã–≤",
    new_status="–†–∞–±–æ—Ç–∞—é"
)

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
on_logout(email="ivan@company.com")
```

### –ü—Ä–∏–º–µ—Ä 4: –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç –ø–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º

```python
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
violations = break_mgr.get_violations_report(
    date_from="2025-12-09",
    date_to="2025-12-09"
)

for v in violations:
    print(f"‚ö†Ô∏è  {v['Email']}: {v['ViolationType']}")
    print(f"   –û–ø–∏—Å–∞–Ω–∏–µ: {v['Details']}")
```

### –ü—Ä–∏–º–µ—Ä 5: –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
status = break_mgr.get_break_status("ivan@company.com")

print(f"üìä –ì—Ä–∞—Ñ–∏–∫: {status['schedule']['name']}")
print(f"–õ–∏–º–∏—Ç—ã:")
for break_type, limits in status['limits'].items():
    used = status['used_today'][break_type]
    print(f"  {break_type}: {used}/{limits['count']} (–ø–æ {limits['time']} –º–∏–Ω)")

if status['active_break']:
    active = status['active_break']
    print(f"\nüü¢ –ê–∫—Ç–∏–≤–µ–Ω: {active['break_type']}")
    print(f"   –í—Ä–µ–º—è: {active['duration']} –º–∏–Ω –∏–∑ {active['limit']} –º–∏–Ω")
```

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–µ—Ä–µ—Ä—ã–≤ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "–ü–µ—Ä–µ—Ä—ã–≤", –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
python dev-tools/diagnostic/check_break_init.py

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
sqlite3 local_backup.db
SELECT email, assigned_schedule FROM users WHERE email='ivan@company.com';

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f ~/.local/share/WorkTimeTracker/logs/app.log | grep -i "break"

# 4. –í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
# –í config.py:
# LOGGING_LEVEL = logging.DEBUG
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –≥—Ä–∞—Ñ–∏–∫
- ‚ùå Graph —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –≤ Supabase
- ‚ùå BreakStatusIntegration –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–µ—Ä–µ—Ä—ã–≤ –ø—Ä–µ–≤—ã—à–µ–Ω, –Ω–æ Telegram –º–æ–ª—á–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
ping 8.8.8.8

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
curl https://api.telegram.org/bot<TOKEN>/getMe

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ID –∞–¥–º–∏–Ω-–≥—Ä—É–ø–ø—ã
curl https://api.telegram.org/bot<TOKEN>/getUpdates

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.py
grep "BREAK_NOTIFY\|TELEGRAM" config.py

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
grep -i "telegram\|notification" ~/.local/share/WorkTimeTracker/logs/app.log
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π TELEGRAM_BOT_TOKEN
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π TELEGRAM_ADMIN_GROUP_ID
- ‚ùå BREAK_NOTIFY_ADMIN_ON_VIOLATION = False

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –õ–∏–º–∏—Ç—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–∏—Å—Ç–µ–º–∞ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å 0 –ø–µ—Ä–µ—Ä—ã–≤–æ–≤, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –±–æ–ª—å—à–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å BreakLog
sqlite3 local_backup.db
SELECT * FROM break_log
WHERE email='ivan@company.com'
AND date(start_time)=date('now')
ORDER BY start_time;

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å count
SELECT COUNT(*) FROM break_log
WHERE email='ivan@company.com'
AND date(start_time)=date('now')
AND break_type='–ü–µ—Ä–µ—Ä—ã–≤';

# 3. –°–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python dev-tools/diagnostic/reset_breaks_today.py ivan@company.com
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –í BreakLog –∑–∞–ø–∏—Å–∞–Ω—ã –ø–µ—Ä–µ—Ä—ã–≤—ã –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –¥–Ω—è
- ‚ùå –°—Ç–æ–ª–±–µ—Ü `date` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `start_time`
- ‚ùå –†–∞–∑–Ω–∏—Ü–∞ –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∏–¥–∏—Ç –≤ –ø–µ—Ä–µ—Ä—ã–≤–µ 30 –º–∏–Ω—É—Ç, –Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å BREAK_OVERTIME_THRESHOLD
grep "OVERTIME_THRESHOLD" config.py
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 2

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É violations
sqlite3 local_backup.db
SELECT * FROM violations
WHERE email='ivan@company.com'
ORDER BY timestamp DESC;

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
grep -i "over_limit\|violation" ~/.local/share/WorkTimeTracker/logs/app.log
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- ‚ùå BREAK_OVERTIME_THRESHOLD —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 60)
- ‚ùå –ù–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç end_break() –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### KPI —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤

| –ú–µ—Ç—Ä–∏–∫–∞ | –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å | –ù–æ—Ä–º–∞ |
|---------|---|---|
| –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã | Admin ‚Üí Break Analytics | < 5% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| –ü—Ä–µ–≤—ã—à–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ | Admin ‚Üí Violations | < 2% –æ—Ç –≤—Å–µ—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ |
| –ü—Ä–µ–≤—ã—à–µ–Ω–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É | Admin ‚Üí Violations | < 1% –æ—Ç –≤—Å–µ—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ |
| –í–Ω–µ –æ–∫–Ω–∞ | Admin ‚Üí Violations (OUT_OF_WINDOW) | < 10% –æ—Ç –≤—Å–µ—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API | Logs | < 500ms |

### SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–°–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –±—ã–ª–æ —Å–µ–≥–æ–¥–Ω—è:**
```sql
SELECT email, break_type, COUNT(*) as count, SUM(duration_minutes) as total_minutes
FROM break_log
WHERE date = CURRENT_DATE
GROUP BY email, break_type
ORDER BY email;
```

**–¢–æ–ø –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π:**
```sql
SELECT email, violation_type, COUNT(*) as violations
FROM violations
WHERE date >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY email, violation_type
ORDER BY violations DESC
LIMIT 10;
```

**–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ä—ã–≤–æ–≤:**
```sql
SELECT break_type, AVG(duration_minutes) as avg_duration
FROM break_log
WHERE date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY break_type;
```

---

## üéì –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ –î–û

1. ‚úÖ **–í—Å–µ–≥–¥–∞ –Ω–∞–∑–Ω–∞—á–∞–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
2. ‚úÖ **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ–∫–Ω–∞** (–Ω–µ 9:00-17:00, –∞ 10:00-12:00)
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è** —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
4. ‚úÖ **–í–∫–ª—é—á–∞–π—Ç–µ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è
5. ‚úÖ **–†–µ–∑–µ—Ä–≤–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** —Ä–µ–≥—É–ª—è—Ä–Ω–æ (—ç–∫—Å–ø–æ—Ä—Ç –≤ Excel)

### ‚ùå –ù–ï–õ–¨–ó–Ø

1. ‚ùå **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã** –≤—Ä—É—á–Ω—É—é –≤ Supabase (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ API)
2. ‚ùå **–ù–µ —É–¥–∞–ª—è–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏** –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã
3. ‚ùå **–ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –ª–∏–º–∏—Ç—ã < 5 –º–∏–Ω—É—Ç** (—Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –≥–ª—é—á–∏—Ç—å)
4. ‚ùå **–ù–µ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ Telegram** –Ω–∞ –±–æ–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
5. ‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `~/.local/share/WorkTimeTracker/logs/`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `dev-tools/diagnostic/diagnose_breaks.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `config.py`
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: `supabase_api.py`

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 09.12.2025
