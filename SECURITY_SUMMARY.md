# –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ WorkTimeTracker

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. **–ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Supabase –∫–ª—é—á** (`config.py:30`)
   - –£–¥–∞–ª–∏—Ç—å `os.environ.setdefault("SUPABASE_KEY", "...")`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email** (`user_app/login_window.py`)
   - –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏

3. **Race condition –≤ —Å–µ—Å—Å–∏—è—Ö** (`user_app/login_window.py:192-196`)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting** (`telegram_bot/main.py`)
   - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ DDoS –∞—Ç–∞–∫

## üü† –í—ã—Å–æ–∫–∏–µ —Ä–∏—Å–∫–∏

5. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö credentials** (`config.py:152`)
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (0o600)

6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ Supabase API** (`supabase_api.py`)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è UUID, email, –¥–∞—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é

7. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ email –∏ session_id –≤ –ª–æ–≥–∞—Ö

8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** (`admin_app/main_admin.py`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

## üü° –°—Ä–µ–¥–Ω–∏–µ —Ä–∏—Å–∫–∏

9. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–µ `except Exception`
10. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ä–∏—Å–∫ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
11. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `mkstemp` –≤–º–µ—Å—Ç–æ `NamedTemporaryFile`
12. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç CSRF** - –ø—Ä–∏ –≤–µ–±-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üîµ –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

13. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ UUID** - –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
14. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π** - —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
15. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

## üìã –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ä–µ—Ç –∏–∑ –∫–æ–¥–∞
```python
# config.py - –£–î–ê–õ–ò–¢–¨ —Å—Ç—Ä–æ–∫—É 30:
# os.environ.setdefault("SUPABASE_KEY", "...")

# –ó–ê–ú–ï–ù–ò–¢–¨ –Ω–∞:
SUPABASE_KEY = os.getenv("SUPABASE_KEY")
if not SUPABASE_KEY:
    raise ValueError("SUPABASE_KEY must be set")
```

### 2. –î–æ–±–∞–≤–∏—Ç—å rate limiting
```python
# telegram_bot/main.py
from collections import defaultdict
from time import time

_rate_limits = defaultdict(list)

def check_rate_limit(chat_id: int, max_per_minute: int = 10) -> bool:
    now = time()
    requests = _rate_limits[chat_id]
    requests[:] = [t for t in requests if now - t < 60]
    if len(requests) >= max_per_minute:
        return False
    requests.append(now)
    return True
```

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```python
# config.py
import stat
fd, tmp_path = tempfile.mkstemp(suffix='.json')
try:
    with os.fdopen(fd, 'wb') as tmp:
        tmp.write(json_bytes)
    os.chmod(tmp_path, stat.S_IRUSR | stat.S_IWUSR)  # 0o600
    yield Path(tmp_path)
finally:
    try:
        os.unlink(tmp_path)
    except:
        pass
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:** 4
- **–í—ã—Å–æ–∫–∏–µ:** 4  
- **–°—Ä–µ–¥–Ω–∏–µ:** 4
- **–õ–æ–≥–∏—á–µ—Å–∫–∏–µ:** 3

**–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:** —Å–º. `SECURITY_ANALYSIS.md`
