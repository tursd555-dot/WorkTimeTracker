# Инструкция по сборке приложений WorkTimeTracker для Windows

Это руководство поможет вам собрать все приложения проекта в исполняемые файлы (.exe) для распространения среди администраторов и пользователей.

## Требования

### Системные требования
- Windows 7 или выше
- Python 3.10 или выше
- Минимум 2 ГБ свободного места на диске

### Необходимые пакеты Python

Установите все зависимости проекта:

```bash
pip install -r requirements.txt
pip install pyinstaller
```

Или установите PyInstaller отдельно:

```bash
pip install pyinstaller
```

### Необходимые файлы перед сборкой

Убедитесь, что в корне проекта присутствуют следующие файлы:

1. **secret_creds.zip** - зашифрованный архив с учетными данными для доступа к Google Sheets/Supabase
2. **config.py** - файл конфигурации проекта
3. **.env** (опционально) - файл с переменными окружения для Telegram бота

## Быстрая сборка всех приложений

Для сборки всех трех приложений (Админка, Пользовательское приложение, Telegram бот) используйте единый скрипт:

```bash
python build_all_windows.py
```

Этот скрипт:
- Проверит наличие всех необходимых файлов
- Соберет все три приложения
- Создаст пакет для распространения в папке `release/`

## Сборка отдельных приложений

### Сборка только админки

```bash
python build_all_windows.py --admin
```

Или напрямую:

```bash
python dev-tools/build/build_admin.py
```

### Сборка только пользовательского приложения

```bash
python build_all_windows.py --user
```

Или напрямую:

```bash
python dev-tools/build/build_user.py
```

### Сборка только Telegram бота

```bash
python build_all_windows.py --bot
```

Или напрямую:

```bash
python dev-tools/build/build_bot.py
```

## Опции сборки

### Опции единого скрипта build_all_windows.py

```bash
# Собрать только админку
python build_all_windows.py --admin

# Собрать только пользовательское приложение
python build_all_windows.py --user

# Собрать только бота
python build_all_windows.py --bot

# Собрать все приложения (по умолчанию)
python build_all_windows.py --all

# Не очищать директории сборки перед началом
python build_all_windows.py --no-clean

# Не создавать пакет для распространения
python build_all_windows.py --no-package
```

## Результаты сборки

После успешной сборки вы найдете:

### Структура папок

```
dist/
├── WorkTimeTracker_Admin/      # Админское приложение
│   ├── WorkTimeTracker_Admin.exe
│   └── [другие файлы]
├── WorkTimeTracker_User/         # Пользовательское приложение
│   ├── WorkTimeTracker_User.exe
│   └── [другие файлы]
└── WorkTimeTracker_Bot/          # Telegram бот
    ├── WorkTimeTracker_Bot.exe
    └── [другие файлы]

release/
└── WorkTimeTracker_Release_YYYYMMDD_HHMMSS/  # Готовый пакет для распространения
    ├── WorkTimeTracker_Admin/
    ├── WorkTimeTracker_User/
    ├── WorkTimeTracker_Bot/
    ├── README.txt
    └── WorkTimeTracker_Release_YYYYMMDD_HHMMSS.zip  # Архив (опционально)
```

## Распространение приложений

### Для администратора

1. Скопируйте папку `WorkTimeTracker_Admin` из папки `release/`
2. Передайте администратору всю папку целиком
3. Администратор должен:
   - Распаковать папку в удобное место (например, `C:\Program Files\WorkTimeTracker\Admin`)
   - Запустить `WorkTimeTracker_Admin.exe`
   - Убедиться, что файл `secret_creds.zip` находится в той же папке

### Для пользователя

1. Скопируйте папку `WorkTimeTracker_User` из папки `release/`
2. Передайте пользователю всю папку целиком
3. Пользователь должен:
   - Распаковать папку в удобное место (например, `C:\Program Files\WorkTimeTracker\User`)
   - Запустить `WorkTimeTracker_User.exe`
   - Убедиться, что файл `secret_creds.zip` находится в той же папке
   - Войти в систему используя свой email

### Для Telegram бота

1. Скопируйте папку `WorkTimeTracker_Bot` из папки `release/`
2. Убедитесь, что файл `.env` настроен с правильными токенами Telegram
3. Передайте всю папку администратору сервера
4. Администратор должен:
   - Распаковать папку в удобное место
   - Запустить `WorkTimeTracker_Bot.exe`
   - Бот будет работать в фоновом режиме

## Важные замечания

### Файлы, которые должны быть в папке приложения

Каждое приложение требует наличия следующих файлов в своей папке:

- **secret_creds.zip** - ОБЯЗАТЕЛЬНО! Без этого файла приложения не смогут подключиться к базе данных
- Все файлы из папки `dist/AppName/` - не удаляйте их, они необходимы для работы

### Размер приложений

- Админка: ~100-150 МБ
- Пользовательское приложение: ~100-150 МБ
- Telegram бот: ~80-120 МБ

### Логи

Все приложения создают логи в папке `logs/` (создается автоматически в папке приложения).

### Антивирусы

Некоторые антивирусы могут блокировать исполняемые файлы, собранные PyInstaller. Это ложное срабатывание. Если это происходит:

1. Добавьте папку с приложением в исключения антивируса
2. Или временно отключите антивирус на время первого запуска

## Устранение проблем

### Ошибка "secret_creds.zip не найден"

Убедитесь, что файл `secret_creds.zip` находится в корне проекта перед сборкой.

### Ошибка "config.py не найден"

Убедитесь, что файл `config.py` находится в корне проекта.

### Ошибка импорта модулей

Если при запуске собранного приложения возникают ошибки импорта:

1. Проверьте логи в папке `logs/`
2. Убедитесь, что все необходимые модули указаны в `--hidden-import` в скриптах сборки
3. Попробуйте пересобрать приложение с опцией `--clean`

### Приложение не запускается

1. Проверьте логи в папке `logs/`
2. Убедитесь, что все файлы из папки `dist/AppName/` скопированы вместе с .exe файлом
3. Попробуйте запустить из командной строки для просмотра ошибок

## Дополнительная информация

### Структура проекта

```
WorkTimeTracker/
├── admin_app/              # Код админского приложения
├── user_app/              # Код пользовательского приложения
├── telegram_bot/          # Код Telegram бота
├── sync/                  # Модули синхронизации
├── shared/                # Общие модули
├── dev-tools/build/       # Скрипты сборки
│   ├── build_admin.py
│   ├── build_user.py
│   └── build_bot.py
├── build_all_windows.py   # Единый скрипт сборки
├── config.py             # Конфигурация
├── secret_creds.zip       # Учетные данные (зашифрованы)
└── requirements.txt       # Зависимости Python
```

### Контакты и поддержка

При возникновении проблем:
1. Проверьте логи в папке `logs/`
2. Обратитесь к разработчикам проекта

---

**Дата создания:** 2024
**Версия:** 1.0
