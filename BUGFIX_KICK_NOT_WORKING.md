# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ (kick) –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–†–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å" –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏:
- ‚úÖ –ü—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω"
- ‚úÖ –°—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "kicked"
- ‚ùå **–ù–û** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## üîç –ü—Ä–∏—á–∏–Ω–∞

**Row Level Security (RLS)** –≤ Supabase –±–ª–æ–∫–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `work_sessions`.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏ –Ω–∞ "kicked" ‚úÖ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `SUPABASE_KEY` —Å –ø—Ä–∞–≤–∞–º–∏ service_role
   - –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

2. **User app** –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ‚è±Ô∏è
   - –¢–∞–π–º–µ—Ä `shift_check_timer` –≤—ã–∑—ã–≤–∞–µ—Ç `_is_session_finished_remote()`
   - –ú–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `api.check_user_session_status(email, session_id)`

3. **Supabase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `403 Forbidden`** ‚ùå
   - RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –ú–µ—Ç–æ–¥ `check_user_session_status()` –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É
   - –°—Ç–∞—Ç—É—Å "kicked" –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è

4. **–ú–µ—Ç–æ–¥ `force_logout_by_admin()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è** ‚ùå
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ –±—ã–ª–æ kicked
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–ª—é—á–∏—Ç—å RLS (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) - –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

–≠—Ç–æ —Å–∞–º–æ–µ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç

2. **–û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor**
   - –í –ª–µ–≤–æ–º –º–µ–Ω—é: `SQL Editor` ‚Üí `New query`

3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã:**

```sql
-- –û—Ç–∫–ª—é—á–∞–µ–º RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü WorkTimeTracker
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE work_sessions DISABLE ROW LEVEL SECURITY;
ALTER TABLE work_log DISABLE ROW LEVEL SECURITY;
ALTER TABLE break_log DISABLE ROW LEVEL SECURITY;
```

4. **–ù–∞–∂–º–∏—Ç–µ `RUN` –∏–ª–∏ `Ctrl+Enter`**

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```sql
-- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å rls_enabled = false –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
SELECT
    tablename,
    rowsecurity as rls_enabled
FROM pg_tables
WHERE schemaname = 'public'
AND tablename IN ('users', 'work_sessions', 'work_log', 'break_log');
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
tablename       | rls_enabled
----------------|------------
users           | false
work_sessions   | false
work_log        | false
break_log       | false
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (–¥–ª—è production)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å RLS –≤–∫–ª—é—á–µ–Ω–Ω—ã–º (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ production):

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor**

2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `supabase_rls_policies.sql`:**
   - –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ü–∏—é "–í–ê–†–ò–ê–ù–¢ 2"
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã CREATE POLICY

3. **–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –ø—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:**

```sql
-- –í–∫–ª—é—á–∞–µ–º RLS
ALTER TABLE work_sessions ENABLE ROW LEVEL SECURITY;

-- –°–æ–∑–¥–∞—ë–º –ø–æ–ª–∏—Ç–∏–∫—É —Ä–∞–∑—Ä–µ—à–∞—é—â—É—é —á—Ç–µ–Ω–∏–µ –≤—Å–µ–º
CREATE POLICY "Allow public read access on work_sessions"
ON work_sessions FOR SELECT
TO public
USING (true);

-- –†–∞–∑—Ä–µ—à–∞–µ–º service role –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
CREATE POLICY "Allow service role full access on work_sessions"
ON work_sessions FOR ALL
TO service_role
USING (true)
WITH CHECK (true);
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Service Role Key (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** Service Role Key –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö!

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç **–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** –¥–ª—è production, –Ω–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Settings ‚Üí API
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `service_role key` (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
3. –í —Ñ–∞–π–ª–µ `.env` –∑–∞–º–µ–Ω–∏—Ç–µ `SUPABASE_KEY` –Ω–∞ service role key

```env
# –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –í PRODUCTION!
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJzZXJ2aWNlX3JvbGUi...
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è:

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

```powershell
python diagnose_kick.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
‚úÖ API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: SupabaseAPI
‚úÖ get_all_active_sessions
‚úÖ get_active_session
‚úÖ check_user_session_status
‚úÖ kick_active_session
‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: X
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ user app

```powershell
python check_logs.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏ —Ç–∞–π–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ ActiveSessions
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å "kicked"
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ –º–µ—Ç–æ–¥ force_logout_by_admin

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
‚úÖ –¢–∞–π–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ ActiveSessions –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
```

### 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º kick –º–µ—Ö–∞–Ω–∏–∑–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```powershell
python test_kick_realtime.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç kick —á–µ—Ä–µ–∑ API
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–∫—Ä—ã–ª–æ—Å—å –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–°–ª–µ–¥–∏—Ç–µ –∑–∞ user app** - –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å—Å—è —á–µ—Ä–µ–∑ ~30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ kick

### 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

**–®–∞–≥ 1:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ user app
```powershell
python user_app/main.py
```
- –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –ª—é–±—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 9@ya.ru)

**–®–∞–≥ 2:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
```powershell
python admin_app/main_admin.py
```

**–®–∞–≥ 3:** –ù–∞–π–¥–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏
- –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "–ö–æ—Ç –µ –ü–∞–ª—å—Ç–æ - 9@ya.ru"

**–®–∞–≥ 4:** –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å"
- –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏: –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é"

**–®–∞–≥ 5:** –û–∂–∏–¥–∞–π—Ç–µ 30 —Å–µ–∫—É–Ω–¥
- User app –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –æ–∫–Ω–æ "–í—ã –±—ã–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"
- –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç 10 —Å–µ–∫—É–Ω–¥
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å—Å—è

---

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è kick:

```python
# –í gui.py (user_app)

# –¢–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
self.shift_check_timer = QTimer(self)
self.shift_check_timer.timeout.connect(self._auto_check_shift_ended)
self.shift_check_timer.start(30000)  # 30 —Å–µ–∫

def _auto_check_shift_ended(self):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏ –≤ Supabase
    if self._is_session_finished_remote():
        # 2. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "kicked" –∏–ª–∏ "finished"
        self.force_logout_by_admin()

def _is_session_finished_remote(self):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API
    st = api.check_user_session_status(self.email, self.session_id)
    return st in ("finished", "kicked")

def force_logout_by_admin(self):
    # 1. –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
    self.shift_ended = True
    self.finish_btn.setEnabled(False)

    # 2. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º LOGOUT –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
    # 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Supabase
    # 4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ —Å –æ–±—Ä–∞—Ç–Ω—ã–º –æ—Ç—Å—á—ë—Ç–æ–º
    # 5. –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π:

```
Admin Panel                    Supabase DB                User App
===========                    ===========                ========

[–ù–∞–∂–∞—Ç—å kick] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ status = "kicked"
                                      ‚îÇ
                                      ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ [–¢–∞–π–º–µ—Ä: 30 —Å–µ–∫]
                                      ‚îÇ              check_user_session_status()
                                      ‚îÇ
                                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ status = "kicked"
                                                         ‚îÇ
                                                         ‚ñº
                                                  force_logout_by_admin()
                                                         ‚îÇ
                                                         ‚ñº
                                                  [–û–∫–Ω–æ: "–†–∞–∑–ª–æ–≥–∏–Ω–µ–Ω"]
                                                         ‚îÇ
                                                         ‚ñº
                                                  [10 —Å–µ–∫—É–Ω–¥ –æ—Ç—Å—á—ë—Ç]
                                                         ‚îÇ
                                                         ‚ñº
                                                  QApplication.quit()
```

---

## üêõ –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∞ 403 Forbidden

```powershell
python diagnose_kick.py
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `‚ùå –û—à–∏–±–∫–∞ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: 403 Forbidden`:
- RLS –≤—Å—ë –µ—â—ë –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ SQL –∫–æ–º–∞–Ω–¥—ã –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

–ï—Å–ª–∏ –æ–∫–Ω–æ "–†–∞–∑–ª–æ–≥–∏–Ω–µ–Ω" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `%APPDATA%/WorkTimeTracker/logs/` (Windows)
- –ò—â–∏—Ç–µ `[ADMIN_LOGOUT]` –≤ –ª–æ–≥–∞—Ö
- –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û–∫–Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

–ï—Å–ª–∏ –ø–æ—Å–ª–µ kick –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–∞–π–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç:
   - –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `[AUTO_LOGOUT_DETECT]` –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏–ª—Å—è –≤ –ë–î:
   ```powershell
   python diagnose_kick.py
   ```
3. –£–≤–µ–ª–∏—á—å—Ç–µ —á–∞—Å—Ç–æ—Ç—É –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è —Ç–µ—Å—Ç–∞):
   ```python
   # –í gui.py —Å—Ç—Ä–æ–∫–∞ 317
   self.shift_check_timer.start(5000)  # –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 30
   ```

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `supabase_rls_policies.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RLS
- `diagnose_kick.py` - –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
- `test_kick_detection.py` - –¢–µ—Å—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è kick
- `BUGFIX_KICK_NOT_WORKING.md` - –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## ‚úÖ –†–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Å—Å–∏–∏ ‚Üí kick –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª—é—á–∏—Ç—å RLS –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–µ —á—Ç–µ–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```powershell
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
python diagnose_kick.py

# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å kick
python user_app/main.py        # –í–æ–π—Ç–∏
python admin_app/main_admin.py # Kicked
# –ñ–¥–∞—Ç—å 30 —Å–µ–∫ ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ** (–í–∞—Ä–∏–∞–Ω—Ç 1 - –æ—Ç–∫–ª—é—á–∏—Ç—å RLS)
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** (`python diagnose_kick.py`)
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ kick –º–µ—Ö–∞–Ω–∏–∑–º**
4. **–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

**–î–∞—Ç–∞:** 2025-12-09
**–í–µ—Ä—Å–∏—è:** v20.5
**–í–µ—Ç–∫–∞:** `claude/analyze-project-repo-014htDps2c1UeCDCCYHN7UqC`
